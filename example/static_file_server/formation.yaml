gateway StaticFileServer:
  ENV:
    STATIC_PATH: null
    TIMEOUT: 10s
    PORT: 8080

fork forkRequest:
  ENV.DISTRIBUTE: copy
   
proc orderMediaTypeFirst:
  COMMAND: node lib/orderMediaTypeFirst

# There don't seem to be reasons to have this configurable
# ENV.PICK: as_comes
merge mergeResponse: {}

proc lookupMediaType:
  COMMAND: node lib/lookupMediaType

proc readFile:
  ENV.BASE_PATH: $staticBasePath
  COMMAND: node lib/readFile

assign:
  $staticBasePath: StaticFileServer.ENV.STATIC_PATH

flow:
  - StaticFileServer -> forkRequest
  - forkRequest -> lookupMediaType -> mergeResponse
  - forkRequest -> readFile -> mergeResponse
  - mergeResponse -> orderMediaTypeFirst -> StaticFileServer