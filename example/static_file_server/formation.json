{
  "static_file_server": {
    "type": "http",
    "assign": {
      "$_read_file_base_path": "path"
    },
    "proxy_out": "_fork_request",
    "proxy_in": "_order_mime_type_first"
  },

  "_fork_request": { 
    "type": "fork",
    "distribute": "copy",
    "outs": [
      "_lookup_mime_type",
      "_read_file"
    ]
  },

  "_order_mime_type_first": { 
    "type": "process",
    "command": "node lib/order_mime_type_first",
    "in": "_merge_response"
  },

  "_merge_response": { 
    "type": "merge",
    "pick": "as_comes",
    "ins": [
      "_lookup_mime_type",
      "_read_file"
    ]
  },

  "_lookup_mime_type": { 
    "type": "process",
    "command": "node lib/lookup_mime_type"
  },

  "_read_file": {
    "type": "process",
    "assign": {
      "environment.BASE_PATH": "$_read_file_base_path"
    },
    "command": "node lib/read_file"
  }
}