gateway Server:
  ENV:
    STATIC_PATH: null
    TIMEOUT: 5m
    PORT: 8080

fork forkRequest:
  ENV.DISTRIBUTE: copy
   
proc mediaTypeAndFileContent:
  COMMAND: node lib/media_type_and_file_content

# There don't seem to be reasons to have this configurable
# ENV.PICK: as_comes
merge mergeResponse: {}

proc lookupMediaType:
  COMMAND: node lib/lookup_media_type

proc readFile:
  ENV.BASE_PATH: $staticBasePath
  COMMAND: node lib/read_file

assign:
  $staticBasePath: Server.ENV.STATIC_PATH

flow:
  - Server -> forkRequest
  - forkRequest -> lookupMediaType -> mergeResponse
  - forkRequest -> readFile -> mergeResponse
  - mergeResponse -> mediaTypeAndFileContent -> Server